(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pagesMsg/msgDetail/msgDetail"],{"0516":function(e,t,i){},"0e69":function(e,t,i){"use strict";i.r(t);var n=i("381e"),o=i.n(n);for(var a in n)"default"!==a&&function(e){i.d(t,e,function(){return n[e]})}(a);t["default"]=o.a},1404:function(e,t,i){"use strict";i.r(t);var n=i("c18d"),o=i("0e69");for(var a in o)"default"!==a&&function(e){i.d(t,e,function(){return o[e]})}(a);i("1549");var s=i("2877"),r=Object(s["a"])(o["default"],n["a"],n["b"],!1,null,null,null);t["default"]=r.exports},1549:function(e,t,i){"use strict";var n=i("0516"),o=i.n(n);o.a},"381e":function(e,t,i){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=i("983c"),o=i("68bf"),a=i("451a"),s=i("10c9"),r=i("baf9"),c=i("a0ec"),l=i("e41b"),d=i("6594"),h=i("2f2e"),u=i("418c"),m=function(){return i.e("pagesMsg/components/im/receive/imgReceiveView").then(i.bind(null,"595f"))},g=function(){return i.e("pagesMsg/components/im/receive/textReceiveView").then(i.bind(null,"8942"))},f=function(){return i.e("pagesMsg/components/im/receive/voiceReceiveView").then(i.bind(null,"37e3"))},I=function(){return i.e("pagesMsg/components/im/receive/positionReceiveView").then(i.bind(null,"fbb4"))},v=function(){return i.e("pagesMsg/components/im/receive/videoReceiveView").then(i.bind(null,"568c"))},p=function(){return i.e("pagesMsg/components/im/me/textMeView").then(i.bind(null,"055c"))},C=function(){return i.e("pagesMsg/components/im/me/voiceMeView").then(i.bind(null,"751d"))},M=function(){return i.e("pagesMsg/components/im/me/imgMeView").then(i.bind(null,"5310"))},w=function(){return i.e("pagesMsg/components/im/me/videoMeView").then(i.bind(null,"3744"))},S=function(){return i.e("pagesMsg/components/im/me/positionMeView").then(i.bind(null,"d091"))},y=function(){return i.e("pagesMsg/components/im/headView").then(i.bind(null,"e86a"))},L=function(){return Promise.all([i.e("common/vendor"),i.e("pagesMsg/components/im/sendMsg")]).then(i.bind(null,"af15"))},b=function(){return i.e("components/scrollLoading").then(i.bind(null,"d59e"))},x=function(){return i.e("components/showModal").then(i.bind(null,"b881"))},D={page:null,pageScrollTimeOutVal:null,imgList:[],caseId:"",cityId:"",caseType:"",reSource:"",params:{},ImEvaluateDeal:null,videoPlayerVal:null,haveMoreData:!0},T=e.createInnerAudioContext(),k={data:function(){return{deptName:"",receiveTypes:{img:!0,voice:!0,entrust:!0,position:!0,houseLiaoKe:!0,video:!0},meTypes:{img:!0,voice:!0,house:!0,video:!0,houseWuYe:!0},currentClickIndex:"err",sendInputBottom:0,serviceId:this.ImChart.getServiceId(),accid:"",scrollLoading:!0,messageId:"",titleText:"",isShield:0,chartList:[],meHeadeImg:c.Const.imDefaultHeadImg,otherHeadImg:c.Const.platformIcon,emptyViewHeight:"51px",serviceLinkShow:!1,serviceLinkArr:[],showSendHouseLinkView:!1,sendHouseLinkItem:new a.ChartDetailItem,agentInfoItem:{},showBackIndex:!1,couponId:"",showCouponTc:!1,couponInfo:{},noClickBackIndex:null,recomendHouseList:[],isMoreSendInfo:!1,autoSendLiskStatus:1,evaluateViewShow:!1,videoTcShow:!1,videoSrc:"",videoFirstImg:"",servicePhone:"",haveMoreData:!0,isScrollIng:!1,isIphoneX:!1,scrollIntoView:""}},components:{imgReceiveView:m,textReceiveView:g,voiceReceiveView:f,positionReceiveView:I,videoReceiveView:v,textMeView:p,voiceMeView:C,imgMeView:M,videoMeView:w,positionMeView:S,headView:y,sendMsg:L,scrollLoading:b,showModal:x},onLoad:function(t){e.getSystemInfoSync().model.indexOf("iPhone X")>=0&&(this.isIphoneX=!0),this.initDeptName(t),D.page=this,this.initParams(t),this.ImChart.messageId=t.messageId||"",this.initImChart(),this.ImChart.inChartDetail=!0,(new r.Notification).addObserver(this,"ImLinkSuccessChange",s.Notify.ImLinkSuccessChange.Name),(new r.Notification).addObserver(this,"UserInfoChanged",s.Notify.UserInfoChanged.Name),(new r.Notification).addObserver(this,"MsgReadChanged",s.Notify.MsgReadChanged.Name),(new r.Notification).addObserver(this,"UpChartMsgChanged",s.Notify.UpChartMsgChanged.Name),(new r.Notification).addObserver(this,"MsgSendSuccessChange",s.Notify.MsgSendSuccessChange.Name),(new r.Notification).addObserver(this,"ClickChartMoreInfo",s.Notify.ClickChartMoreInfo.Name)},onShow:function(){this.ImChart.inChartDetail=!0},onHide:function(){this.voicePlayChange({isPlayIng:!0}),this.ImChart.inChartDetail=!1},onUnload:function(){this.voicePlayChange({isPlayIng:!0}),(new r.Notification).removeObserverAllNotification(this),this.ImChart.inChartDetail=!1,this.ImChart.messageId=""},onNavigationBarButtonTap:function(e){e.id&&"telephone"===e.id&&(this.servicePhone?this.$refs.modal.show():this.DifferenceApi.showToast("暂无电话"))},methods:{initDeptName:function(e){var t=this;if(e.messageId&&2!=d.GetLoginModel.getAccountSource()){var i=e.messageId.toString();i.indexOf("ld_")>=0?new l.UserDeptName({userId:i.replace("ld_",""),isBroker:i.indexOf("ld_")>=0?0:1}).send().then(function(e){e.errCode===c.Const.success&&(t.deptName=e.data&&e.data.deptName||"")}):new l.GetBrokerContactInfo({archiveId:i.replace("ld_","")}).send().then(function(e){t.deptName=e.DATA&&e.DATA.deptName||""})}},goBack:function(){e.navigateBack({delta:1})},onModalChanged:function(e){e&&this.DifferenceApi.makePhoneCall(this.servicePhone)},videoPlayChange:function(e){},voicePlayChange:function(t){var i=this;if(t.isPlayIng)return this.currentClickIndex="err",T&&T.pause&&T.pause(),T&&T.stop&&T.stop(),void(T&&T.destroy&&T.destroy());T=e.createInnerAudioContext(),this.currentClickIndex=t.index,T.src=t.url,T.play(),T.onError(function(e){i.currentClickIndex="err"}),T.onStop(function(e){i.currentClickIndex="err"}),T.onEnded(function(e){i.currentClickIndex="err"})},lookMaxImgChange:function(e){this.lookImgMax(e.content)},initImChart:function(){var e=this;this.ImChart.imChartVal&&this.initData(function(){e.scrollLoading=!1})},ImLinkSuccessChange:function(){this.initImChart()},MsgReadChanged:function(e,t){var i=this.chartList||[],n=!0,o=!1,a=void 0;try{for(var s,r=i[Symbol.iterator]();!(n=(s=r.next()).done);n=!0){var c=s.value;void 0!=c.timeStr&&c.timeStr<=t&&(c.isRead=!0)}}catch(l){o=!0,a=l}finally{try{n||null==r.return||r.return()}finally{if(o)throw a}}this.chartList=i},OnMoreSendChanged:function(e){this.isMoreSendInfo=e},onInputFocus:function(e){},UserInfoChanged:function(){var e=this;this.ImChart.initImUserInfo().then(function(){e.initData(),e.scrollLoading=!1}),this.ImChart.inChartDetail=!0},initParams:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};D.params=e,e.name&&(this.titleText=e.name),e.messageId&&(this.messageId=e.messageId,this.ImChart.messageId=e.messageId),void 0!=e.isShield&&(this.isShield=e.isShield),(new n.UserInfoModel).getModel("accid")&&(this.accid=(new n.UserInfoModel).getModel("accid"),this.ImChart.setUuAccid(this.accid)),e.accid&&(this.accid=e.accid,(new n.UserInfoModel).setModel(e.accid,"accid"),this.ImChart.setUuAccid(e.accid)),e.couponId&&(this.couponId=e.couponId);var t=["caseId","cityId","caseType","reSource"];t.map(function(t){D[t]=e[t]||""}),D.reSource||(D.reSource="1")},initData:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){};this.initChartDetail(function(e){return t(e)}),new l.GetUserMobile({imId:this.messageId}).send().then(function(t){t.errCode===c.Const.success&&t.data&&(e.servicePhone=t.data.userMobile||"")})},initChartDetail:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){};this.ImChart.imChartVal.getUser({account:this.messageId,sync:!0,done:function(t,i){var n=c.Const.imDefaultHeadImg;i&&i.avatar&&(n=(new h.Utils).dealImgSrcSize(i.avatar,80,80)),(new d.ConsultantListModel).getModel()&&(new d.ConsultantListModel).getModel()[e.messageId]&&(new d.ConsultantListModel).getModel()[e.messageId].avatar&&(n=(new h.Utils).dealImgSrcSize((new d.ConsultantListModel).getModel()[e.messageId].avatar,80,80)),e.otherHeadImg=n}}),this.ImChart.getHistory(this.messageId,(new Date).getTime()+1e4,10,function(i){e.chartList=i.list||[],t(i),D.haveMoreData=i.haveMoreData||!1,e.meHeadeImg=d.GetLoginModel.getUserPhoto()?(new h.Utils).dealImgSrcSize(d.GetLoginModel.getUserPhoto(),80,80):c.Const.imDefaultHeadImg,i.name&&(e.titleText=i.name);var n=d.GetLoginModel.getUserId()||"",o=(new u.ChatListModel).getModel()||{},a=o[n]||{},s=a[e.messageId]||{};s.name=e.titleText||i.name||s.name||"",a[e.messageId]=s,o[n]=a,(new u.ChatListModel).setModel(o),e.upImgList(),setTimeout(function(){e.scrollToBottom()},500)})},scrollClick:function(){this.isMoreSendInfo=!0,(new r.Notification).postNotification(s.Notify.ClickChartDetailScroll.Name)},ClickChartMoreInfo:function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n={more:{height:e.upx2px(340)},emoji:{height:e.upx2px(540)},normal:{height:e.upx2px(110)}},o=n[i.type]&&n[i.type].height?n[i.type].height+"px":n.normal.height+"px";i.value||(o=n.normal.height+"px"),this.emptyViewHeight=o,i.disabledScroll||this.scrollToBottom()},scrollToBottom:function(){var e=this;clearTimeout(D.pageScrollTimeOutVal),D.pageScrollTimeOutVal=null,this.scrollIntoView="",D.pageScrollTimeOutVal=setTimeout(function(){e.scrollIntoView="scrollIntoId"},300)},upImgList:function(){D.imgList=[];var e=!0,t=!1,i=void 0;try{for(var n,o=this.chartList[Symbol.iterator]();!(e=(n=o.next()).done);e=!0){var a=n.value;"img"==a.type&&D.imgList.push(a.content)}}catch(s){t=!0,i=s}finally{try{e||null==o.return||o.return()}finally{if(t)throw i}}},lookImgMax:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";e.previewImage({current:t,urls:D.imgList,indicator:"number"})},clickChartDetail:function(e){"img"==e.type&&this.lookImgMax(e.content)},UpChartMsgChanged:function(e,t){t&&("house"===t.type&&t.mySend&&(this.showSendHouseLinkView=!1),this.chartList.push(t),this.upImgList(),this.scrollToBottom())},MsgSendSuccessChange:function(e,t){for(var i=0;i<this.chartList.length;i++){var n=this.chartList[i]||{};if(t.type&&"position"===t.type){var o=JSON.parse(t.msg.content);if(o.data.locationImageUrl===n.content.staticImg){n.isSendUser=!1,n.msg=t.msg||{},n.sendFail=n.sendFail||!1,this.$set(this.chartList,i,n);break}}if(t.url===n.content){n.isSendUser=!1,n.msg=t.msg||{},n.sendFail=n.sendFail||!1,this.$set(this.chartList,i,n);break}}},sendTextMsgCommon:function(e){var t=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};new a.ImSendMessage(this.messageId).sendText(e).then(function(){var n=(new a.DealChartDetail).dealEmoji(e),s=new a.ChartDetailItem;s.type="text",s.content=e,s.mySend=!0,s.time=(0,o.formatTimeNew)((new Date).getTime()),s.emoji=n,s.hasEmoji=n[1].length>0,t.chartList.push(s),s.showTime=a.DealLastMsgTime.checkShowTime(t.messageId,(new Date).getTime()),a.DealLastMsgTime.setTime((new Date).getTime(),t.messageId),t.scrollToBottom(),i(s)})},scrolltoupper:function(){var e=this;if(D.haveMoreData&&!this.isScrollIng){this.isScrollIng=!0;var t=this.chartList||[],i=t.length>0&&t[0].timeStr||(new Date).getTime();this.ImChart.getHistory(this.messageId,i,10,function(i){console.log(i,"getHistory"),e.isScrollIng=!1,e.haveMoreData=i.haveMoreData||!1,e.chartList=(i.list||[]).concat(t),e.upImgList()})}}}};t.default=k}).call(this,i("543d")["default"])},"6e73":function(e,t,i){"use strict";(function(e){i("d3e9"),i("921b");n(i("66fd"));var t=n(i("1404"));function n(e){return e&&e.__esModule?e:{default:e}}e(t.default)}).call(this,i("543d")["createPage"])},c18d:function(e,t,i){"use strict";var n=function(){var e=this,t=e.$createElement,i=(e._self._c,{title:"拨打电话",content:e.servicePhone,confirmText:"呼叫",cancelColor:"rgba(0,0,0,0.6)",confirmColor:"#3396fb"});e.$mp.data=Object.assign({},{$root:{a0:i}})},o=[];i.d(t,"a",function(){return n}),i.d(t,"b",function(){return o})}},[["6e73","common/runtime","common/vendor"]]]);