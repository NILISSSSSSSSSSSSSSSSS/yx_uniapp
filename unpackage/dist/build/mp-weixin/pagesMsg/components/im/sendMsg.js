(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pagesMsg/components/im/sendMsg"],{"460d":function(e,t,i){"use strict";i.r(t);var n=i("4e9d"),o=i.n(n);for(var s in n)"default"!==s&&function(e){i.d(t,e,function(){return n[e]})}(s);t["default"]=o.a},"4e9d":function(e,t,i){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=i("10c9"),o=i("baf9"),s=i("451a"),a=i("68bf"),c=i("e326"),r=i("1d45"),h=i("0513"),m=i("451a"),u=i("7dc7"),d=null,l=null,f={addEmojiList:[],recordTimeOutVal:null,voiceStartTime:0,isClickPhoto:!1,haveLocationAuthSetting:!1},g={data:function(){return{adjustPosition:!0,oftenUseBtnShow:!1,oftenUseMap:{false:{src:"http://cdn.haofang.net/static/uuminiapp/im/useful-word.png",className:"chang_yong_yu"},true:{src:"http://cdn.haofang.net/static/uuminiapp/im/keyboard-new.png",className:"chang_input_icon"}},emojiBtnShow:!1,emojiMap:{false:{src:"http://cdn.haofang.net/static/xfyx-uniapp/msg/emoji_send.png",className:"emoji_type_input"},true:{src:"http://cdn.haofang.net/static/xfyx-uniapp/msg/emoji_send.png",className:"key_type_input"}},voiceBtnShow:!1,voiceMap:{false:{src:"http://cdn.haofang.net/static/xfyx-uniapp/msg/voice_send.png",className:"voice_type_input"},true:{src:"http://cdn.haofang.net/static/xffx-uniapp/msg/keyword_new.png",className:"voice_type_input"}},inputFocus:!1,moreTypeShow:!1,oftenUserList:["这套房子的情况能给我详细介绍一下吗？","什么时候可以看房呢？","这套房子价格怎样？是必须全款吗？","可以按揭吗？商贷/公积金贷都可以吗？","有装修比较新的房子吗？","这房子房东还有抵押吗？","你们公司收佣是多少呢？","你好，我想要这个区套三双卫的精装房，能帮我推荐几套合适的房子吗？","我想看看附近的学区房，麻烦给我推荐一下，谢谢！","你好，我想咨询几个买房问题","你们会帮忙办理过户等后续手续吗？","小区环境怎么样？还有周边的交通和配套如何？","有啥优惠政策没？"],emojiSwiperList:{},moreSendTypeList:[{event:"getPhoto",imgSrc:"http://cdn.haofang.net/static/xfyx-uniapp/msg/ablum_send.png",text:"相册",size:"55%",className:"album_send"},{event:"getTakePhoto",imgSrc:"http://cdn.haofang.net/static/xfyx-uniapp/msg/photo_send.png",text:"拍摄",size:"55%",className:"camera_send"},{event:"getPosition",imgSrc:"http://cdn.haofang.net/static/xfyx-uniapp/msg/position_send.png",text:"位置",size:"55%",className:"camera_send"}],voiceTcShow:!1,voiceTimeLength:"00:00",voiceTcDes:"手指上滑，取消发送",voiceCancelSend:!1,inputText:"",isPingBi:!1,startRecord:!1,isService:!1,haveVoiceAuthSetting:!1}},props:{messageId:{type:String,default:""},isShield:{type:String|Number,default:0},chartList:{type:Array,default:function(){return[]}}},watch:{isShield:function(){1==this.isShield?this.isPingBi=!0:this.isPingBi=!1},chartList:function(){this.initShowEvaluateBtn()}},mounted:function(){this.initShowEvaluateBtn();var t=this;this.initEmojiSwiperData(),(new o.Notification).addObserver(this,"ClickChartDetailScroll",n.Notify.ClickChartDetailScroll.Name),this.isPingBi=!(1!=this.isShield),this.isService=!(this.messageId!=this.ImChart.getServiceId()),e.getSetting({success:function(e){t.haveVoiceAuthSetting=e.authSetting["scope.record"]||!1,f.haveLocationAuthSetting=e.authSetting["scope.userLocation"]||!1}})},destroyed:function(){(new o.Notification).removeObserverAllNotification(this)},methods:{initShowEvaluateBtn:function(){var e=this;new c.ImEvaluateDeal(this.chartList).showEvaluateBtn(function(t){t=!1;var i=e.moreSendTypeList,n=i.findIndex(function(e){return"evaluateSend"===e.event});do{if(!t){-1!==n&&i.splice(n,1);break}var o={event:"evaluateSend",imgSrc:"http://cdn.haofang.net/static/kdbweb/zdzfminiapp/zdzfPlatform/common/evaluate.png",text:"评价",size:"50%"};-1===n&&i.push(o)}while(0);e.moreSendTypeList=i})},initEmojiSwiperData:function(){var e=(new s.GetEmojiMap).dealEmojiSwiperData();this.emojiSwiperList=e.emojiList||{}},changeOftenUseType:function(){this.oftenUseBtnShow=!this.oftenUseBtnShow,this.oftenUseBtnShow&&(this.emojiBtnShow=!1,this.moreTypeShow=!1),this.$emit("OnMoreSendChanged",this.oftenUseBtnShow),this.NcClickInfo()},changeEmojiType:function(){this.emojiBtnShow=!this.emojiBtnShow,this.emojiBtnShow&&(this.oftenUseBtnShow=!1,this.moreTypeShow=!1),this.$emit("OnMoreSendChanged",this.oftenUseBtnShow),this.NcClickInfo({type:"emoji",value:this.emojiBtnShow})},changeVoiceType:function(){this.voiceBtnShow=!this.voiceBtnShow,this.voiceBtnShow&&(this.oftenUseBtnShow=!1,this.moreTypeShow=!1),this.$emit("OnMoreSendChanged",this.oftenUseBtnShow),this.NcClickInfo(),this.voiceBtnShow?this.inputFocus=!1:this.inputFocus=!0},lookMoreSendType:function(){this.startRecord?this.startRecord=!1:(this.moreTypeShow=!this.moreTypeShow,this.moreTypeShow&&(this.oftenUseBtnShow=!1,this.emojiBtnShow=!1),this.$emit("OnMoreSendChanged",this.moreTypeShow),this.NcClickInfo({type:"more",value:this.moreTypeShow}))},ClickChartDetailScroll:function(){this.moreTypeShow=!1,this.oftenUseBtnShow=!1,this.emojiBtnShow=!1,this.$emit("OnMoreSendChanged",!1),this.NcClickInfo({type:"normal",disabledScroll:!0})},NcClickInfo:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};clearTimeout(l),l=null,l=setTimeout(function(){"ios"===e.getSystemInfoSync().platform&&(t.disabledScroll=!0),(new o.Notification).postNotification(n.Notify.ClickChartMoreInfo.Name,t)},100)},senMoreMsg:function(t){this.isPingBi&&"pingBiChart"!=t.event?e.showToast({title:"您已把对方屏蔽，解除屏蔽后才能进行联系",icon:"none",duration:2e3}):this[t.event](t)},getPhoto:function(e){this.getTakePhoto(e,["album"])},getTakePhoto:function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:["camera"],n=this;(new r.Permission).photoPermission(function(t){1!==t?3===t&&e.chooseImage({count:9,sourceType:i,success:function(e){var t=!0,i=!1,o=void 0;try{for(var s,a=(e.tempFilePaths||[])[Symbol.iterator]();!(t=(s=a.next()).done);t=!0){var c=s.value;n.uploadImg(c)}}catch(r){i=!0,o=r}finally{try{t||null==a.return||a.return()}finally{if(i)throw o}}}}):e.showModal({title:"",content:"请打开设置-允许相机权限",showCancel:!1,confirmText:"去开启",confirmColor:"#3396fb",success:function(e){e.confirm&&(new r.Permission).openSet()}})})},uploadImg:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";if(t)if(this.messageId){var i=(new Date).getTime();new s.ImSendMessage(this.messageId).sendImage(t).then(function(t){var c=new s.ChartDetailItem;c.type="img",c.content=t.url,c.width=t.w,c.height=t.h,c.mySend=!0,c.isRead=!1,c.timeStr=i,c.isSendUser=!0,c.time=(0,a.formatTimeNew)(i),c.showTime=s.DealLastMsgTime.checkShowTime(e.messageId,i),s.DealLastMsgTime.setTime(i,e.messageId),(new o.Notification).postNotification(n.Notify.UpChartMsgChanged.Name,c)})}else this.DifferenceApi.showToast("暂无收件人id");else this.DifferenceApi.showToast("暂无图片路径，无法发送")},sendOftenUseMsg:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";this.isPingBi?e.showToast({title:"您已把对方屏蔽，解除屏蔽后才能进行联系",icon:"none",duration:2e3}):this.sendTextMsgCommon(t)},sendTextInput:function(e){var t=e.detail.value;t=t.replace(/(^\s*)|(\s*$)/g,""),this.inputText=t},sendTextFocus:function(e){this.NcClickInfo(),this.$emit("onInputFocus",{height:e.detail.height})},sendTextBtn:function(){this.isPingBi?e.showToast({title:"您已把对方屏蔽，解除屏蔽后才能进行联系",icon:"none",duration:2e3}):(this.sendTextMsgCommon(this.inputText),this.inputText="")},addEmoji:function(e){this.inputText+=e.fileName,f.addEmojiList.push(e.fileName)},delEmoji:function(){if(0!==f.addEmojiList.length){var e=this.inputText,t=f.addEmojiList[f.addEmojiList.length-1],i=e.lastIndexOf(t);e=e.substring(0,i)+e.substring(i+t.length,e.length),this.inputText=e}},sendTextMsgCommon:function(e){var t=this;new s.ImSendMessage(this.messageId).sendText(e).then(function(){var i=(new s.DealChartDetail).dealEmoji(e),c=new s.ChartDetailItem;c.type="text",c.content=e,c.mySend=!0,c.timeStr=(new Date).getTime(),c.time=(0,a.formatTimeNew)((new Date).getTime()),c.emoji=i,c.isRead=!1,c.hasEmoji=i[1].length>0,c.showTime=s.DealLastMsgTime.checkShowTime(t.messageId,(new Date).getTime()),s.DealLastMsgTime.setTime((new Date).getTime(),t.messageId),(new o.Notification).postNotification(n.Notify.UpChartMsgChanged.Name,c)})},videoSend:function(){var t=this;e.chooseVideo({count:1,sourceType:["camera","album"],compressed:!0,success:function(e){new s.ImSendMessage(t.messageId).sendVideo(e.tempFilePath).then(function(i){var c=new s.ChartDetailItem;c.type="video",c.content=e.tempFilePath,c.mySend=!0,c.isRead=!1,c.timeStr=(new Date).getTime(),c.time=(0,a.formatTimeNew)((new Date).getTime()),c.showTime=s.DealLastMsgTime.checkShowTime(t.messageId,(new Date).getTime()),s.DealLastMsgTime.setTime((new Date).getTime(),t.messageId),(new o.Notification).postNotification(n.Notify.UpChartMsgChanged.Name,c)})}})},pingBiChart:function(){var e=this;this.ImChart.blockMsg(this.messageId,!this.isPingBi).then(function(t){e.isPingBi=!e.isPingBi})},voiceSend:function(){this.startRecord=!0},hideRecord:function(){this.startRecord=!1},checkHaveVoicePermission:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){},t=this;t.haveVoiceAuthSetting&&e(t.haveVoiceAuthSetting)},gotoAppPermissionSetting:function(){if("ios"===e.getSystemInfoSync().platform){var t=plus.ios.import("UIApplication"),i=t.sharedApplication(),n=plus.ios.import("NSURL"),o=n.URLWithString("app-settings:");i.openURL(o),plus.ios.deleteObject(o),plus.ios.deleteObject(n),plus.ios.deleteObject(i)}else{var s=plus.android.importClass("android.content.Intent"),a=plus.android.importClass("android.provider.Settings"),c=plus.android.importClass("android.net.Uri"),r=plus.android.runtimeMainActivity(),h=new s;h.setAction(a.ACTION_APPLICATION_DETAILS_SETTINGS);var m=c.fromParts("package",r.getPackageName(),null);h.setData(m),r.startActivity(h)}},onRecordStop:function(){var e=this,t=this;d.onStop(function(i){if(t.haveVoiceAuthSetting&&!t.voiceCancelSend&&!((new Date).getTime()-f.voiceStartTime<800))if(i.duration<800)t.DifferenceApi.showToast("录音时间太短");else if(i.tempFilePath){var c=(new Date).getTime();new s.ImSendMessage(e.messageId).sendVoice(i.tempFilePath,c-f.voiceStartTime).then(function(t){var i=new s.ChartDetailItem;i.type="voice",i.content=t.file.url,i.mySend=!0,i.isRead=!1,i.timeStr=c,i.isSendUser=!0,i.voiceLength=t.file.dur?Math.round(Number(t.file.dur)/1e3):1,i.time=(0,a.formatTimeNew)(c),i.showTime=s.DealLastMsgTime.checkShowTime(e.messageId,(new Date).getTime()),s.DealLastMsgTime.setTime(c,e.messageId),(new o.Notification).postNotification(n.Notify.UpChartMsgChanged.Name,i)})}else t.DifferenceApi.showToast("录音失败,暂无文件")})},recordStart:function(t){var i=this;if(this.voiceCancelSend=!1,i.voiceTimeLength="00:00",f.startInfo=t.changedTouches[0],i.haveVoiceAuthSetting)return d=e.getRecorderManager(),f.voiceStartTime=(new Date).getTime(),void i.upRecordStart();e.getSetting({success:function(t){i.haveVoiceAuthSetting=t.authSetting["scope.record"]||!1,void 0==t.authSetting["scope.record"]||t.authSetting["scope.record"]?(d=e.getRecorderManager(),f.voiceStartTime=(new Date).getTime()):e.showModal({title:"授权提示",showCancel:!0,content:"要先允许使用[录音权限]才可以发送哦",confirmText:"去设置",confirmColor:"#4ebb62",success:function(t){t.confirm&&e.openSetting({success:function(e){e.authSetting["scope.record"]&&(f.haveVoiceAuthSetting=!0)}})}})}})},recordMove:function(e){var t=e.changedTouches[0].pageY||"",i=f.startInfo.pageY||"";t<i&&i-t>100?(this.voiceTcDes="松开手指，取消发送",this.voiceCancelSend=!0):(this.voiceTcDes="手指上滑，取消发送",this.voiceCancelSend=!1)},recordEnd:function(e){this.voiceTcShow=!1,f.endInfo=e.changedTouches[0],clearInterval(f.recordTimeInterval),f.recordTimeInterval=null,clearTimeout(f.recordTimeOutVal),f.recordTimeOutVal=null,d&&(d.stop(),d=null)},upRecordStart:function(){var e=this;clearTimeout(f.recordTimeOutVal),f.recordTimeOutVal=null,f.recordTimeOutVal=setTimeout(function(){var t={duration:6e5,sampleRate:44100,numberOfChannels:1,encodeBitRate:192e3,format:"mp3"};if(d){var i=function(){n++;var t="00:"+n;if(n<10&&(t="00:0"+n),n>=60){var i=parseInt(n/60),o=n%60;t=(i<10?"0"+i:i)+":"+(o<10?"0"+o:o)}e.voiceTimeLength=t};d.start(t),e.voiceTcShow=!0,console.error("--that.voiceTcShow--",e.voiceTcShow),e.onRecordStop();var n=0;i(),f.recordTimeInterval=setInterval(function(){i()},1e3)}},300)},evaluateSend:function(){var t=this;new c.ImEvaluateDeal(this.chartList).checkIsCanEvaluate(function(i){console.log("---判断是否能够显示评价---",i),i?t.$emit("onEvaluateChanged",{show:!0}):e.showModal({title:"",content:"我最近未给你提供服务，请咨询结束后为我评价，我将做的更好哦！",showCancel:!1,confirmText:"我知道了",confirmColor:"#ff5400"})})},getPosition:function(){var t=this;(new h.GpsInfoModel).getModel("gpsInfo");f.haveLocationAuthSetting?e.chooseLocation({success:function(e){var i=new m.PositionChartItem;if(i.lat=Number(e.latitude),i.lng=Number(e.longitude),i.address=e.address,i.name=e.name,t.messageId){var c=(new Date).getTime();new s.ImSendMessage(t.messageId).sendLocation(i).then(function(e){i.staticImg=e.url;var r=new s.ChartDetailItem;r.type="position",r.content=i,r.mySend=!0,r.isRead=!1,r.timeStr=c,r.isSendUser=!0,r.time=(0,a.formatTimeNew)(c),r.showTime=s.DealLastMsgTime.checkShowTime(t.messageId,c),s.DealLastMsgTime.setTime(c,t.messageId),(new o.Notification).postNotification(n.Notify.UpChartMsgChanged.Name,r)})}else(new u.DifferenceApi).showToast("暂无收件人id")}}):e.getSetting({success:function(t){f.haveLocationAuthSetting=t.authSetting["scope.userLocation"]||!1,void 0==t.authSetting["scope.userLocation"]||t.authSetting["scope.userLocation"]?f.haveLocationAuthSetting=!0:e.showModal({title:"授权提示",showCancel:!0,content:"要先允许使用[地理位置权限]才可以发送哦",confirmText:"去设置",confirmColor:"#4ebb62",success:function(t){t.confirm&&e.openSetting({success:function(e){e.authSetting["scope.userLocation"]&&(f.haveLocationAuthSetting=!0)}})}})}})}}};t.default=g}).call(this,i("543d")["default"])},"611e":function(e,t,i){},"803b":function(e,t,i){"use strict";var n=i("611e"),o=i.n(n);o.a},a0f9:function(e,t,i){"use strict";var n=function(){var e=this,t=e.$createElement;e._self._c},o=[];i.d(t,"a",function(){return n}),i.d(t,"b",function(){return o})},af15:function(e,t,i){"use strict";i.r(t);var n=i("a0f9"),o=i("460d");for(var s in o)"default"!==s&&function(e){i.d(t,e,function(){return o[e]})}(s);i("803b");var a=i("2877"),c=Object(a["a"])(o["default"],n["a"],n["b"],!1,null,"57541e47",null);t["default"]=c.exports}}]);
;(global["webpackJsonp"] = global["webpackJsonp"] || []).push([
    'pagesMsg/components/im/sendMsg-create-component',
    {
        'pagesMsg/components/im/sendMsg-create-component':(function(module, exports, __webpack_require__){
            __webpack_require__('543d')['createComponent'](__webpack_require__("af15"))
        })
    },
    [['pagesMsg/components/im/sendMsg-create-component']]
]);
