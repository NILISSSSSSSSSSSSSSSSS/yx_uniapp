(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/msgList/msgList"],{"0995":function(t,e,i){"use strict";(function(t){i("3ea8"),i("921b");s(i("66fd"));var e=s(i("27b9"));function s(t){return t&&t.__esModule?t:{default:t}}t(e.default)}).call(this,i("6e42")["createPage"])},"27b9":function(t,e,i){"use strict";i.r(e);var s=i("5fe1"),a=i("485a");for(var n in a)"default"!==n&&function(t){i.d(e,t,function(){return a[t]})}(n);i("3527");var o,r=i("f0c5"),c=Object(r["a"])(a["default"],s["b"],s["c"],!1,null,null,null,!1,s["a"],o);e["default"]=c.exports},3527:function(t,e,i){"use strict";var s=i("8a5c"),a=i.n(s);a.a},"485a":function(t,e,i){"use strict";i.r(e);var s=i("a96e"),a=i.n(s);for(var n in s)"default"!==n&&function(t){i.d(e,t,function(){return s[t]})}(n);e["default"]=a.a},"5fe1":function(t,e,i){"use strict";var s,a=function(){var t=this,e=t.$createElement;t._self._c},n=[];i.d(e,"b",function(){return a}),i.d(e,"c",function(){return n}),i.d(e,"a",function(){return s})},"8a5c":function(t,e,i){},a96e:function(t,e,i){"use strict";(function(t,s){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var a=i("5969"),n=i("64cf"),o=i("b0ea"),r=i("2b2e"),c=i("4de1"),m=i("1675"),u=i("a538"),g=i("fb1c"),d=i("5962");function h(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function l(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}function f(t,e,i){return e&&l(t.prototype,e),i&&l(t,i),t}function p(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}var C=function(){function t(){h(this,t)}return f(t,null,[{key:"init",value:function(){this.hideAll();var t=Math.abs(this.endClientY-this.startClientY),e=Math.abs(this.endClientX-this.startClientX);t>=e?this.hide():e<=40||(this.endClientX-this.startClientX<0?this.show():this.endClientX-this.startClientX>0&&this.hide())}},{key:"hideAll",value:function(){this.page.chartList.map(function(t){t.isShowBtn=!1})}},{key:"hide",value:function(){arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.index;if(this.page.chartList){var t=this.page.chartList[this.index]||{};t.isShowBtn=!1,this.page.$set(this.page.chartList,this.index,t)}}},{key:"show",value:function(){if(this.page.chartList){var t=this.page.chartList[this.index]||{};t.isShowBtn=!0,this.page.$set(this.page.chartList,this.index,t)}}}]),t}();p(C,"startClientX",0),p(C,"startClientY",0),p(C,"endClientX",0),p(C,"endClientY",0),p(C,"page",null),p(C,"index",0);var v={data:function(){return{chartList:null,defaultHead:u.Const.imDefaultHeadImg,serviceId:this.ImChart.getServiceId(),systemMsgItem:{name:"系统消息",lastTime:"",msg:"",unRead:0}}},onShow:function(){this.initSystemMsg(),n.UpUnReadNumTab.setTab(),this.initData()},onLoad:function(){(new r.Notification).addObserver(this,"ImLinkSuccessChange",o.Notify.ImLinkSuccessChange.Name),(new r.Notification).addObserver(this,"UpChartListChanged",o.Notify.UpChartListChanged.Name)},onUnload:function(){(new r.Notification).removeObserverAllNotification(this)},onNavigationBarButtonTap:function(e){e.id&&"contract"===e.id&&t.navigateTo({url:"/pagesMsg/contacts/contacts"})},methods:{goToCustomer:function(){t.navigateTo({url:"/pagesMsg/contacts/contacts"})},initData:function(){this.drawChartList()},drawChartList:function(){var t=this,e=this.ImChart.getServiceId(),i=new c.DealChartListModel(e).getMsgList(),s=[];i=i||[],i=i.sort(new a.compare("msg_timestamp").minToMax());var o=[],r=[];i.length>0&&i.map(function(e){if(e.msg_timestamp&&e.accid!==g.ProjectConfigConst.systemMsgMessageId&&e.accid!==g.ProjectConfigConst.remindMsgMessageId){e.msg_timestamp=e.msg_timestamp.replace(/-/g,"/");var i=new n.ChartListItem;i.messageId=e.accid||"",i.headImg=e.icon?e.icon:t.defaultHead,i.headImg=(new m.Utils).dealImgSrcSize(i.headImg,140,140),i.name=e.name||"",i.lastTime=(0,a.formatTimeNew)(e.msg_timestamp),i.msg=e.msg_type&&"VIDEO"===e.msg_type?"[视频]":e.body||"",i.sendtime=(0,a.formatTimeNew)(e.msg_timestamp),i.unRead=n.UpUnReadNumTab.getUnReadNum(e.accid),i.lastTime_stamp=new Date(e.msg_timestamp).getTime(),i.isShield=e.isShield||"",i.isShowBtn=!1,1==d.GetLoginModel.getAccountSource()&&(i.messageId=i.messageId.toString(),e.compName=i.messageId.indexOf("ld_")>=0?"置业顾问":"经纪人"),i.compName=e.compName||"",i.isTop=e.isTop||2,1==i.isTop?o.push(i):r.push(i)}}),o.length>0&&o.sort(new a.compare("lastTime_stamp").maxToMin()),r.length>0&&r.sort(new a.compare("lastTime_stamp").maxToMin()),s=o.concat(r),setTimeout(function(){t.chartList=s},10)},imgError:function(t,e){t.headImg=this.defaultHead,this.$set(this.chartList,e,t)},touchStart:function(t,e,i){var s=t.changedTouches||t.mp.changedTouches||[];t&&s[0]&&(C.startClientX=s[0].clientX||0,C.startClientY=s[0].clientY||0)},touchEnd:function(t,e,i){var s=t.changedTouches||t.mp.changedTouches||[];i.messageId!=this.ImChart.getServiceId()&&(C.endClientX=s[0].clientX||0,C.endClientY=s[0].clientY||0,C.index=e,C.page=this,C.init())},blockMsg:function(t,e){this.ImChart.blockMsg(t.messageId,!(1==t.isShield))},delMsg:function(t,e){this.ImChart.DeleteMsg(t.messageId)},upTopStatus:function(t,e){new c.DealChartListModel(t.messageId).upTopStatus(t.isTop&&2!=t.isTop?2:1)},getChartDetail:function(e,i){e.unRead=0,n.UpUnReadNumTab.removeReadNum(e.messageId),t.navigateTo({url:"/pagesMsg/msgDetail/msgDetail?messageId="+e.messageId+"&name="+(e.name||"")})},UpChartListChanged:function(){this.initData(),this.initSystemMsg()},ImLinkSuccessChange:function(){this.initSystemMsg()},initSystemMsg:function(){var t=this;this.ImChart.imChartVal&&this.ImChart.getHistoryOriginal(g.ProjectConfigConst.systemMsgMessageId).then(function(e){console.log(s("系统消息",e," at pages\\msgList\\msgList.vue:337"));var i=e&&e.msgs||[],o=t.systemMsgItem;if(0===i.length)return o.lastTime=(0,a.formatTimeNew)((new Date).getTime()),o.msg="暂无消息",void(t.systemMsgItem=o);t.systemMsgItem.unRead=n.UpUnReadNumTab.getUnReadNum(g.ProjectConfigConst.systemMsgMessageId)||0,i=i.sort(new a.compare("time").maxToMin());var r=JSON.parse(i[0].content),c=r.data||{};o.msg=c.CONTENT||"暂无消息",o.lastTime=(0,a.formatTimeNew)(i[0].time||(new Date).getTime()),t.systemMsgItem=o})},goToSystemDetail:function(){this.systemMsgItem.unRead=0,n.UpUnReadNumTab.removeReadNum(g.ProjectConfigConst.systemMsgMessageId),t.navigateTo({url:"/pagesMsg/systemMsg/systemMsg"})}}};e.default=v}).call(this,i("6e42")["default"],i("0de9")["default"])}},[["0995","common/runtime","common/vendor"]]]);